---
// import { posts } from "@utils/data";
import Layout from '@layouts/HomeLayout.astro';
import PostListSection from "@components/PostListSection.astro";
import PostList from "@components/PostList.astro";

const profiles = await Astro.glob("../sections/profile.md");
const profile = profiles[0];
const greetingArray = profile?.frontmatter.greeting.split("_");

const max = 6;

const allPosts = await Astro.glob('./posts/*.md');
let posts = [...allPosts];
posts = posts.sort((a, b) => new Date(b.frontmatter.date).valueOf() - new Date(a.frontmatter.date).valueOf()).slice(0, max);

const more = allPosts.length <= max ? false : true;
---

<Layout title="Welcome to Notebook.">
	<main>
		{profile ? (
			<section class="profile">
				<img src={profile.frontmatter.avatar} alt="" class="avatar">
				<article class="profile_text">
					<p class="greeting">{greetingArray[0]} <strong>{greetingArray[1]}</strong>{greetingArray[2]}</p>
					<p class="sub-greeting">{profile.frontmatter.subGreeting}</p>
					<p class="statement">{profile.frontmatter.statement}</p>
					<p class="sub-statement">{profile.frontmatter.subStatement}</p>
					<p class="intro">{profile.frontmatter.intro}</p>
				</article>
			</section>
		) : null}
		
		<PostListSection title="Latest Article">
			<PostList posts={posts} more={more}  />
		</PostListSection>
	</main>
</Layout>

<style>
	main {
		padding: 0 32px;
	}

	.profile {
		max-width: var(--max-w);
		padding: 48px 0;
		margin: 0 auto;
		display: flex;
		align-items: center;
		gap: 64px;
	}

	.profile_text {
		flex: 1;
	}

	.greeting {
		font-size: 2rem;
	}

	.greeting strong {
		color: var(--clr-accent);
	}

	.statement {
		font-size: 2.67rem;
		font-family: var(--ff-heading);
		line-height: 1.2;
	}

	[class^="sub"] {
		color: var(--clr-gray);
	}

	.intro {
		color: var(--clr-secondary);
		margin-top: 1.2em;
	}

	@media (max-width: 1024px) {
		.avatar {
			max-width: 300px;
		}
	}

	@media (max-width: 768px) {
		.profile {
			flex-direction: column;
		}
	}

	@media (max-width: 600px) {
		.greeting {
			font-size: 1.5rem;
		}

		.statement {
			font-size: 2rem;
		}
	}
</style>